# 📌 Android Malicious Indicator Scanner  

**Detects suspicious indicators in extracted APK strings**  

🔹 **Author**: L0WK3Y  
🔹 **Category**: Mobile Reverse Engineering / Malware Analysis  
🔹 **License**: MIT  

---

## 🎯 Overview  

The **Android Malicious Indicator Scanner** analyzes extracted strings from an **Android APK** to identify **suspicious behaviors**, such as:  

✅ **C2 URLs, IPs, and domains**  
✅ **Sensitive permissions** (e.g., `READ_SMS`, `CALL_PHONE`)  
✅ **Obfuscation & encryption methods** (e.g., `Base64`, `AES`, `XOR`)  
✅ **Anti-debugging & emulator detection**  
✅ **Dynamic code loading & native execution**  
✅ **Reflection-based evasion techniques**  
✅ **Potential root detection methods**  
✅ **High-entropy data (possible encrypted payloads)**  

The script reads extracted string data from a **CSV file** (generated by `string_extraction.py`), scans for indicators, and outputs findings in a structured **rich**-formatted table and **CSV report**.

---

## 🛠️ Features  

### 🔍 **Scans CSV Output from `string_extraction.py`**  
- Automatically lists available CSV files in `src/output/`  
- Prompts user to select a CSV for analysis  

### 🚨 **Identifies Suspicious Indicators**  
- **Permissions**: Extracts and checks for **dangerous** Android permissions  
- **Obfuscation**: Flags Base64, XOR, AES, RC4, and reflection usage  
- **Anti-debugging**: Detects emulator checks and debugger detection  
- **Dynamic Code Loading**: Identifies `DexClassLoader`, `Method.invoke`, and `.dex` loading  
- **Malicious API Calls**: Finds `exec()`, WebView injection, and socket connections  
- **Hidden Asset Manipulation**: Flags access to encrypted assets or payloads  
- **Root Detection**: Identifies system property checks for rooted environments  

### 📊 **Structured Output & Report Generation**  
- **Findings displayed** in a color-coded, rich-formatted table  
- **Duplicates removed** automatically  
- **Results saved as `potential_indicators.csv`** in the output directory  

---

## 🔧 Usage  

### **Run the Script**  
To analyze a CSV for malicious indicators:  

```sh
python malicious_indicator_detection.py
```

### **What It Does**  

1️⃣ **Finds all extracted string CSV files** in `src/output/`  
2️⃣ **Lists available CSVs** and prompts the user to pick one  
3️⃣ **Scans for malicious indicators** in APK-extracted strings  
4️⃣ **Displays findings** in a structured table  
5️⃣ **Saves results** as `potential_indicators.csv` in the same directory  

---

## 📄 Example Output  

```sh
🔎 Android Malicious Indicator Scanner 🔍

📄 Found the following CSV files:
   [1] src/output/malicious_app_strings.csv
   [2] src/output/clean_app_strings.csv

[?] Enter the number of the CSV file to analyze: 1

🔍 Scanning CSV: src/output/malicious_app_strings.csv...

🚨 Permissions Detected:
┌───────────────────────────────────────┬───────────────────────────────┐
│ File                                  │ Suspicious String             │
├───────────────────────────────────────┼───────────────────────────────┤
│ src/output/malicious_app_strings.csv  │ android.permission.READ_SMS   │
│ src/output/malicious_app_strings.csv  │ android.permission.CALL_PHONE │
└───────────────────────────────────────┴───────────────────────────────┘

🚨 Obfuscation Methods Detected:
┌───────────────────────────────────────┬───────────────────────────┐
│ File                                  │ Suspicious String         │
├───────────────────────────────────────┼───────────────────────────┤
│ src/output/malicious_app_strings.csv  │ Base64.decode             │
│ src/output/malicious_app_strings.csv  │ DexClassLoader            │
└───────────────────────────────────────┴───────────────────────────┘

✅ Findings saved to: src/output/potential_indicators.csv
```

---

## ⚠️ Indicators Detected  

### **📜 Permissions**  
Flags Android permissions that could be abused:  
- `READ_SMS`, `RECEIVE_SMS` → **Stealing messages**  
- `CALL_PHONE` → **Silent dialing / premium calls**  
- `READ_CONTACTS` → **Harvesting contact lists**  
- `INTERNET` → **Exfiltrating stolen data**  
- `BIND_DEVICE_ADMIN` → **Persistent malware (Device Admin)**  
- `SYSTEM_ALERT_WINDOW` → **Overlay attacks (e.g., phishing screens)**  

### **🛡️ Anti-Debugging & Emulator Detection**  
Identifies techniques to detect emulation and prevent analysis:  
- `isDebuggerConnected()`, `android.os.Debug.waitForDebugger()`  
- Checks for **QEMU properties** (emulator detection)  
- Uses **Build.FINGERPRINT, Build.MODEL** for device checks  

### **🔐 Obfuscation & Encryption**  
Flags use of:  
- **Base64, XOR, AES, RC4, MD5** (common for encrypted payloads)  
- **Reflection-based execution** (`Class.forName`, `Method.invoke`)  
- **Dynamic Code Loading** (`DexClassLoader`, `.dex` loading)  

### **📡 Suspicious API Calls**  
Flags network activity, process execution, and dynamic loading:  
- `java.net.Socket` → **Creates suspicious network connections**  
- `java.lang.Runtime.exec()` → **Executes system commands**  
- `android.webkit.WebView.loadUrl()` → **Injects malicious JavaScript**  

### **🎭 Hidden Asset & File Manipulation**  
Flags access to hidden files, assets, and encrypted payloads:  
- `getAssets()`, `getResources()`, `openRawResource()`  
- Dynamic resource loading via `getIdentifier()`  

### **🏴 Root Detection**  
Detects techniques used by apps to check for **rooted devices**:  
- `invoke-static {}, Ljava/lang/System;->getProperty("ro.secure")`  
- Checks for **banned su binary paths**  

---

## 📌 Advanced Features  

### **Entropy-Based Analysis**  
✅ Scans for **high-entropy data** (Base64, AES-encrypted payloads)  
✅ Ignores common files like `.smali` and `.xml`  

### **XOR Obfuscation Detection (Dynamic)**  
✅ Detects `xor-(int|long|byte|short)` operations in **Smali**  
✅ Identifies XOR **key usage** (constant/variable-based obfuscation)  

### **CSV Management**  
✅ **Skips duplicate entries** from subfolders  
✅ **Ignores previously scanned results** (`potential_indicators.csv`)  

---

## 🏴‍☠️ Use Cases  

✅ **Pentesting** – Identify malicious APK behavior and C2 communication  
✅ **Reverse Engineering** – Extract obfuscation techniques and encryption methods  
✅ **Malware Analysis** – Flag anti-analysis and persistence techniques  
✅ **Threat Hunting** – Detect backdoors, hidden execution, and privilege escalation  

---

## ⚙️ Troubleshooting  

### ❌ **No CSV files found!**  
🔹 **Fix:** Run `string_extraction.py` first to generate an extracted strings CSV.  

```sh
python string_extraction.py
python malicious_indicator_detection.py
```

### ❌ **No suspicious indicators found!**  
🔹 **Fix:** The scanned APK may not contain obvious malicious indicators.  
🔹 Try analyzing another CSV file or reviewing extracted strings manually.  

### ❌ **Rich module not found!**  
🔹 **Fix:** Install the required Python module for enhanced UI.  

```sh
pip install rich
```

---

## 📜 License  
This project is licensed under the **MIT License** – feel free to modify and use it as needed.  

---

## 🤝 Contributing  
💡 **Want to improve this tool?** Open an issue or submit a pull request!  


Happy Hunting! 🚀